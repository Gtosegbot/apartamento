<!-- jQuery e Slick JS -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js"></script>

<script>
    $(document).ready(function () {
        // Inicialização do carrossel
        $('.carousel').slick({
            dots: true,
            infinite: true,
            speed: 500,
            slidesToShow: 1,
            slidesToScroll: 1,
            autoplay: true,
            autoplaySpeed: 4000,
            arrows: true,
            adaptiveHeight: true,
            fade: true,
            cssEase: 'linear',
            lazyLoad: 'ondemand'
        });
        
        // Accordion functionality
        $('.accordion-header').click(function() {
            console.log('Accordion clicado:', $(this).text());
            $(this).toggleClass('active');
            $(this).next('.accordion-content').toggleClass('active');
            
            // Registro de evento GA
            gtag('event', 'faq_click', {
                'event_category': 'engagement',
                'event_label': $(this).text()
            });
        });
        
        // Verificação de carregamento
        console.log('jQuery carregado:', typeof jQuery !== 'undefined');
        console.log('Slick carregado:', typeof $.fn.slick !== 'undefined');
        console.log('Elementos FAQ:', $('.faq-section').length);
        console.log('Elementos Accordion:', $('.accordion-item').length);
        console.log('Headers Accordion:', $('.accordion-header').length);
        console.log('Contents Accordion:', $('.accordion-content').length);
        
        // Política de Privacidade Modal
        if (!localStorage.getItem('cookiesAccepted')) {
            $('#privacy-modal').css('display', 'block');
        }
        
        // Fechar modal ao clicar no X
        $('.close').click(function() {
            $('#privacy-modal').css('display', 'none');
        });
        
        // Aceitar cookies
        $('#accept-cookies').click(function() {
            localStorage.setItem('cookiesAccepted', 'true');
            $('#privacy-modal').css('display', 'none');
        });
        
        // N8N Form Integration
        // Show form after 15 seconds
        setTimeout(function() {
            $('#n8n-form-container').addClass('show-modal');
        }, 15000);
        
        // Close modal
        $('.close-modal').click(function() {
            $('#n8n-form-container').removeClass('show-modal');
        });
        
        // Formatação de telefone no padrão E.164
        $('#telefone').on('input', function() {
            let telefone = $(this).val().replace(/\D/g, '');
            
            // Se começar com 0, remover
            if (telefone.startsWith('0')) {
                telefone = telefone.substring(1);
            }
            
            // Se não começar com 55, adicionar
            if (!telefone.startsWith('55')) {
                telefone = '55' + telefone;
            }
            
            // Formatar para exibição (mantendo E.164 para submissão)
            let formattedDisplay;
            if (telefone.length > 12) {
                // Com 9º dígito
                formattedDisplay = `+${telefone.substring(0, 2)} (${telefone.substring(2, 4)}) ${telefone.substring(4, 9)}-${telefone.substring(9)}`;
            } else {
                // Sem 9º dígito ou incompleto
                formattedDisplay = `+${telefone.substring(0, 2)} (${telefone.substring(2, 4)}) ${telefone.substring(4, 8)}-${telefone.substring(8)}`;
            }
            
            // Atualizar o campo com o formato para visualização
            $(this).val(formattedDisplay);
            // Armazenar o formato E.164 para submissão
            $(this).data('e164', '+' + telefone);
        });
        
        // Form submission
        $('#lead-capture-form').submit(function(e) {
            e.preventDefault();
            
            // Usar o formato E.164 armazenado no data attribute
            const telefoneE164 = $('#telefone').data('e164') || ('+55' + $('#telefone').val().replace(/\D/g, ''));
            
            const formData = {
                nome: $('#nome').val(),
                telefone: telefoneE164,
                email: $('#email').val(),
                aceite: $('#aceite-contato').is(':checked'),
                origem: 'website_form'
            };
            
            // Envio para o webhook do n8n
            $.ajax({
                url: 'https://seu-servidor-n8n.com/webhook/lead-capture', // Substitua pela URL do seu webhook
                type: 'POST',
                data: JSON.stringify(formData),
                contentType: 'application/json',
                success: function(response) {
                    $('#lead-capture-form').html('<div class="success-message"><p>Obrigado! Em breve você receberá nossas ofertas exclusivas.</p></div>');
                    gtag('event', 'lead_form_success', {
                        'event_category': 'conversion',
                        'event_label': 'form_n8n'
                    });
                },
                error: function(error) {
                    alert('Ocorreu um erro. Por favor, tente novamente mais tarde.');
                    gtag('event', 'lead_form_error', {
                        'event_category': 'error',
                        'event_label': 'form_n8n'
                    });
                }
            });
        });
        
        // Monitoramento de tempo de permanência
        const startTime = new Date();
        window.addEventListener('beforeunload', function() {
            const endTime = new Date();
            const timeSpent = Math.round((endTime - startTime) / 1000);
            
            gtag('event', 'time_on_page', {
                'event_category': 'engagement',
                'value': timeSpent
            });
        });
    });
</script>
